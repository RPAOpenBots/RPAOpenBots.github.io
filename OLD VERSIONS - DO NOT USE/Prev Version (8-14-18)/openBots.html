<!DOCTYPE html>
<meta charset="UTF-8"> 
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.js"></script>
    <script src="openBotsSchedule.js"></script>
</head>
<html>
<body>

<![if !IE]>
<!--Header-->
<h2 style="display:inline;"><a href="http://dms.cbrands.com/confluence/display/RPA/Blue+Prism+-+Scheduling" style="text-decoration: none;" target="_blank">Todays Bot Schedule: </a>
</h2> 
<div style="display:inline-block"><p id="todaysDate"></p></div>
<div style="float:right; padding-top: 15px;">
    <input type="date" id="dateInput" >
    <input type="submit" value="Change Date" onclick="init(document.getElementById('dateInput').value)" style="border-radius: 5px; border: solid 1px; cursor: pointer;">
</div>
<hr style="width: 100%; border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));"><br>

<!--OUTDATED VERSION TAG-->
<center>
<a style="color:red;" href="file://///CBICDG-MARS/Enterprise%20Share/Global%20Business%20Services/Robotic%20Process%20Automation%20Documents/User%20Folders/BBOBO/Open%20Bots/openBots.html">This is an outdated version of openBots</a>
<br><br></center>

<!--***********************************START BOTS PRINTED SCHEDULES************************************-->
<center>
    <h5 style="margin-top:0"> (All times below are EST) </h5>
<div><p style="border-radius: 50px; width: 100%; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0));">GDC Bots</p></div>
<!--CBIGDC_PBOTZ901-->
<div style="display:inline-block; margin-right: 10px; vertical-align:top;">
    <p id="CBIGDC_PBOTZ901_title" style="padding:15px 5px 5px 5px; line-height: 10px; border-style: solid; border-width: 2px 2px 0px 2px; font-size:20px; margin:0px; background-color:#f2f774"></p>
    <p id="CBIGDC_PBOTZ901_body" style="padding:15px 5px 5px 5px; line-height: 20px; border: solid 2px; font-size:20px; margin:0px; "></p>
    <p id="CBIGDC_PBOTZ901_available" style="font-weight: bold; color: green; "></p>
</div>
<!--CBIGDC_PBOTZ902-->
<div style="display:inline-block; margin-right: 10px; vertical-align:top;">
    <p id="CBIGDC_PBOTZ902_title" style="padding:15px 5px 5px 5px; line-height: 10px; border-style: solid; border-width: 2px 2px 0px 2px; font-size:20px; margin:0px; background-color:#fc8a8a"></p>
    <p id="CBIGDC_PBOTZ902_body" style="padding:15px 5px 5px 5px; line-height: 20px; border: solid 2px; font-size:20px; margin:0px; "></p>
    <p id="CBIGDC_PBOTZ902_available" style="font-weight: bold; color: green;"></p>
</div>
<!--CBIGDC_PBOTZ903-->
<div style="display:inline-block; margin-right: 10px; vertical-align:top;">
    <p id="CBIGDC_PBOTZ903_title" style="padding:15px 5px 5px 5px; line-height: 10px; border-style: solid; border-width: 2px 2px 0px 2px; font-size:20px; margin:0px; background-color:#79b8e5"></p>
    <p id="CBIGDC_PBOTZ903_body" style="padding:15px 5px 5px 5px; line-height: 20px; border: solid 2px; font-size:20px; margin:0px; "></p>
    <p id="CBIGDC_PBOTZ903_available" style="font-weight: bold; color: green;"></p>
</div>
<!--CBIGDC_PBOTZ904-->
<div style="display:inline-block; margin-right: 10px; vertical-align:top;">
    <p id="CBIGDC_PBOTZ904_title" style="padding:15px 5px 5px 5px; line-height: 10px; border-style: solid; border-width: 2px 2px 0px 2px; font-size:20px; margin:0px; background-color:#f4bf7a"></p>
    <p id="CBIGDC_PBOTZ904_body" style="padding:15px 5px 5px 5px; line-height: 20px; border: solid 2px; font-size:20px; margin:0px; "></p>
    <p id="CBIGDC_PBOTZ904_available" style="font-weight: bold; color: green;"></p>
</div><br>
<div><p style="border-radius: 50px; width: 100%; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0));">TDC Bots</p></div>
<!--CBITDC_PBOTZ901-->
<div style="display:inline-block; margin-right: 10px; vertical-align:top;">
    <p id="CBITDC_PBOTZ901_title" style="padding:15px 5px 5px 5px; line-height: 10px; border-style: solid; border-width: 2px 2px 0px 2px; font-size:20px; margin:0px; background-color:#a2dd77"></p>
    <p id="CBITDC_PBOTZ901_body" style="padding:15px 5px 5px 5px; line-height: 20px; border: solid 2px; font-size:20px; margin:0px; "></p>
    <p id="CBITDC_PBOTZ901_available" style="font-weight: bold; color: green;"></p>
</div>
<!--CBITDC_PBOTZ902-->
<div style="display:inline-block; margin-right: 10px; vertical-align:top;">
    <p id="CBITDC_PBOTZ902_title" style="padding:15px 5px 5px 5px; line-height: 10px; border-style: solid; border-width: 2px 2px 0px 2px; font-size:20px; margin:0px; background-color:#d2d7db"></p>
    <p id="CBITDC_PBOTZ902_body" style="padding:15px 5px 5px 5px; line-height: 20px; border: solid 2px; font-size:20px; margin:0px; "></p>
    <p id="CBITDC_PBOTZ902_available" style="font-weight: bold; color: green;"></p>
</div>
<!--CBITDC_PBOTZ903-->
<div style="display:inline-block; margin-right: 10px; vertical-align:top;">
    <p id="CBITDC_PBOTZ903_title" style="padding:15px 5px 5px 5px; line-height: 10px; border-style: solid; border-width: 2px 2px 0px 2px; font-size:20px; margin:0px; background-color:#edf0f2"></p>
    <p id="CBITDC_PBOTZ903_body" style="padding:15px 5px 5px 5px; line-height: 20px; border: solid 2px; font-size:20px; margin:0px; "></p>
    <p id="CBITDC_PBOTZ903_available" style="font-weight: bold; color: green;"></p>
</div>
<!--CBITDC_PBOTZ904-->
<div style="display:inline-block; margin-right: 10px; vertical-align:top;">
    <p id="CBITDC_PBOTZ904_title" style="padding:15px 5px 5px 5px; line-height: 10px; border-style: solid; border-width: 2px 2px 0px 2px; font-size:20px; margin:0px; background-color:#d4fcfb"></p>
    <p id="CBITDC_PBOTZ904_body" style="padding:15px 5px 5px 5px; line-height: 20px; border: solid 2px; font-size:20px; margin:0px; "></p>
    <p id="CBITDC_PBOTZ904_available" style="font-weight: bold; color: green;"></p>
</div>
</center>
<!--***********************************END BOTS PRINTED SCHEDULES************************************-->
<![endif]>

<div style="padding:20px;"></div>
<footer style="position:fixed; bottom:10px;">
    <div style="border: solid 1px; border-radius: 5px; padding: 5px; background-color:#e6e9ef; display:inline; margin-right:5px">
    <div id="today" style="display:inline; border-right: solid 1px; padding-right: 10px"></div>
    <div id="day" style="display:inline; border-right: solid 1px; padding-right: 10px"></div>
    <div id="hour" style="display:inline; border-right: solid 1px; padding-right: 10px"></div>
    <div id="businessDay" style="display:inline; border-right: solid 1px; padding-right: 10px"></div>
    <div id="monthEnd" style="display:inline"></div> 
    </div>
   <a style="padding-left: 3px; color:black;text-decoration:none;border-left:1px solid Blue; font-size: 11px; font-weight: bold;" 
    href="mailto:ben.bobo@cbrands.com?subject=Open Bots Bug&body=Description of Bug/Error: %0D%0A ">Found a Bug? </a>
</footer>

<footer style="padding:5px"></footer>

 
<script>
    var self = this;
    init();

    function init(datePassedIn){
        self.botSched();
        //reset printed schedules 
        document.getElementById("CBIGDC_PBOTZ901_body").innerHTML = ""
        document.getElementById("CBIGDC_PBOTZ902_body").innerHTML = ""
        document.getElementById("CBIGDC_PBOTZ903_body").innerHTML = ""
		document.getElementById("CBIGDC_PBOTZ904_body").innerHTML = ""
        document.getElementById("CBITDC_PBOTZ901_body").innerHTML = ""
        document.getElementById("CBITDC_PBOTZ902_body").innerHTML = ""
        document.getElementById("CBITDC_PBOTZ903_body").innerHTML = ""
		document.getElementById("CBITDC_PBOTZ904_body").innerHTML = ""

        //date passed in?
        if(datePassedIn!=undefined && datePassedIn!=""){
            self.date = new Date(datePassedIn);
            date.setDate(date.getDate() + 1)
            self.hideAvailable = true;
        } else {
            self.hideAvailable = false;
            self.date = new Date();
        }

        //init date variables
        self.weekday = new Array(7);
        weekday[0] = "Sunday";weekday[1] = "Monday";weekday[2] = "Tuesday";weekday[3] = "Wednesday";weekday[4] = "Thursday"; weekday[5] = "Friday";weekday[6] = "Saturday";
        self.today = date.getDate();
        self.hour = date.getHours();
        self.day = weekday[date.getDay()];
        self.lastDayOfMonth = new Date(date.getFullYear(),date.getMonth()+1,0).getDate();
        self.businessDay = "";
        self.monthEndDay = "";
        self.TURNINGPOINT = 15;
        
        document.getElementById("todaysDate").innerHTML = date;

        // Print bots to screen
        printToScreen(CBIGDCxPBOTZ901, "CBIGDC_PBOTZ901");
        printToScreen(CBIGDCxPBOTZ902, "CBIGDC_PBOTZ902");
        printToScreen(CBIGDCxPBOTZ903, "CBIGDC_PBOTZ903");
		printToScreen(CBIGDCxPBOTZ904, "CBIGDC_PBOTZ904");
        printToScreen(CBITDCxPBOTZ901, "CBITDC_PBOTZ901");
        printToScreen(CBITDCxPBOTZ902, "CBITDC_PBOTZ902");
        printToScreen(CBITDCxPBOTZ903, "CBITDC_PBOTZ903");
		printToScreen(CBITDCxPBOTZ904, "CBITDC_PBOTZ904");

        //debug help 
        console.log("Today: " + today)
        console.log("Day of the week: " + day)
        console.log("Hour: " + hour)
        console.log("Business Day: " + businessDay)
        console.log("Month End Day: " + monthEndDay)
        document.getElementById("today").innerHTML = today;
        document.getElementById("day").innerHTML = day;
        document.getElementById("hour").innerHTML = moment(hour + ":00:00", 'HH:mm').format('h:mm A');
        document.getElementById("businessDay").innerHTML = businessDay.replace("N","-").replace("day","Day ");;
        document.getElementById("monthEnd").innerHTML = (monthEndDay.replace("N","-")).replace("MEday","Month End Day ");
    }

    /*
     *  Function()
     *  Print bots schedules to the screen
     */
    function printToScreen(bot, name){
        var isTodayBusinessDay = isBusinessDay(new Date());
        convertDayToBusinessDay(today);
        if(isBusinessDay(date)){ convertDayToMonthEndDay(date); }
        else{ self.monthEndDay="" }
        var available = "*Available";
      
        //remove days other than today 
        for (var property in bot) {
            if (bot.hasOwnProperty(property) && businessDay != property && property.startsWith("day") && property != "daily") {
                delete bot[property];
            }
            if(bot.hasOwnProperty(property) && businessDay != property && property != day && property != "daily" && property != monthEndDay){
                delete bot[property];
            }
        }
        
        //print remaining days
        var outputs = [];
        for (var property in bot) {
            if (bot.hasOwnProperty(property)){
                for (value in bot[property]){
                    if(bot[property][value]===hour){
                        available = " ";
                    }
                    if(!outputs.includes(moment(bot[property][value] + ":00:00", 'HH:mm').format('h:mm A'))){
                        outputs.push(moment(bot[property][value] + ":00:00", 'HH:mm').format('h:mm A'));
                    }
                    bot[property][value] = moment(bot[property][value] + ":00:00", 'HH:mm').format('h:mm A');
                }
            }
        }

        //sort times earliest -> latest
        outputs.sort(function (a, b) {
            return new Date('1970/01/01 ' + a) - new Date('1970/01/01 ' + b);
        });
    
        //set elements for schedules 
        document.getElementById(name+"_title").innerHTML = "<center><strong>"+name+":</strong></center> <br>"
        for (var i=0; i<outputs.length; i++) {
            document.getElementById(name+"_body").innerHTML = "<center>" + document.getElementById(name+"_body").innerHTML + outputs[i] + "</center><br>";
        }
        if(outputs.length === 0){
            document.getElementById(name+"_body").innerHTML = "<center>" + document.getElementById(name+"_body").innerHTML + "None" + "</center><br>";
        }
        
        document.getElementById(name+"_available").innerHTML = available;
        if(self.hideAvailable){
            document.getElementById(name+"_available").innerHTML = " ";
        }
       
    }

    /*
     *  Function()
     *  Convert the day of the month to the calendar day. 
     */
    function convertDayToBusinessDay(today){
        if(today>=1 && today<=TURNINGPOINT){
            businessDay = "day" + today;
        } else {
            businessDay = "dayN" + (lastDayOfMonth - today  + 1);
        }
    }

    /*
     *  Function()
     *  Convert the day of the month to the month end day.
     */
    function convertDayToMonthEndDay(date){
        dayCounter = 1; 
        var lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
        var firstDay = new Date(date.getFullYear(), date.getMonth(), dayCounter);
        var monthEndDays = [];
        var totalEndDays = [];
        var monthEndBusinessDays = [];
        var totalMonthEndBusinessDays = [];
        var passedToday = false;

        while(String(firstDay) != String(lastDay)){
            firstDay = new Date(date.getFullYear(), date.getMonth(), dayCounter);
            if(!passedToday){
                monthEndDays.push(firstDay);
            }
            totalEndDays.push(firstDay);
            if(dayCounter===today){
                passedToday = true;
            }
            dayCounter++;
        }    

        for(var i=1; i<monthEndDays.length; i++){
            if(isBusinessDay(monthEndDays[i])){
                monthEndBusinessDays.push(monthEndDays[i])
            }
        }

        for(var i=1; i<totalEndDays.length; i++){
            if(isBusinessDay(totalEndDays[i])){
                totalMonthEndBusinessDays.push(totalEndDays[i])
            }
        }
        
        monthEndDay = "MEday" + (monthEndBusinessDays.length + 1);
        if(today > TURNINGPOINT){        
            monthEndDay = "MEdayN" + (totalMonthEndBusinessDays.length - monthEndBusinessDays.length+1);
        }
    }

    /*
     *  Function()
     *  Check if passed in day is weekend or holiday 
     */
    function isBusinessDay(dayToCheck){
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        
        const d = dayToCheck;
        var todayCheck = dayToCheck.getDate();
        var dayCheck = self.weekday[dayToCheck.getDay()];
        var monthName = monthNames[d.getMonth()];
        
        // check if weekend
        if(dayCheck === "Saturday" || dayCheck === "Sunday"){
            return false;
        }
        
        // check if New Year's Day
        if (monthName === "January" && todayCheck === 1) {
            return false;
        }
        
        // check if Christmas
        if (monthName === "December" && todayCheck === 25) {
            return false;
        }
        
        // check if 4th of July
        if (monthName === "July" && todayCheck === 4) {
            return false;
        }
        
        // check Memorial Day (last Monday of May)
        if (monthName === "May" && dayCheck === "Monday" && todayCheck > (31 - 7) ) {
            return false;
        }
        
        // check Labor Day (1st Monday of September)
        if (monthName === "September" && todayCheck <= 7 && dayCheck === "Monday") {
            return false;
        }

         // check Thanksgiving (Thursday of November from 22nd-28th)
         if (monthName === "November"&& (todayCheck >= 22 || todayCheck <= 28) && dayCheck === "Thursday") {
            return false;
        }
        
        // check Veterans Day (November 11)
        if (monthName === "November" && todayCheck === 11) {
          return true;
        }
        
        // If nothing else, return true
        return true;
    }

</script>


	<!--[if IE]>
		<center><strong>Program does not work in Internet Explorer. Please use Chrome or Firefox.</strong><br>Thank you!<center>
	<![endif]--> 

</body>
</html>
